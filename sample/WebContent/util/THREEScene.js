sap.ui.define(['sap/ui/core/Control','sap/ui/core/HTML','influenz/de/sample/util/THREEPerspectiveCamera'],function(Control,HTML){'use strict';return Control.extend("influenz.de.sample.util.THREEScene",{metadata:{properties:{height:{defaultValue:1280},width:{defaultValue:720},antiAlias:{defaultValue:true},alpha:{defaultValue:true}},events:{nextFrame:{enablePreventDefault:true}},aggregations:{objects:{type:"influenz.de.sample.util.THREEObject",multiple:true,singularName:"object"},camera:{types:["influenz.de.sample.util.THREEPerspectiveCamera","influenz.de.sample.util.THREECubeCamera"],multiple:false},directionalLight:{type:"influenz.de.sample.util.THREEDirectionalLight",multiple:false},ambientLight:{type:"influenz.de.sample.util.THREEAmbientLight",multiple:false}}},init:function init(){},onBeforeRendering:function onBeforeRendering(){this.setAggregation("camera",this.getAggregation("camera"));this.setAggregation("ambientLight",this.getAggregation("ambientLight"));this.setAggregation("directionalLight",this.getAggregation("directionalLight"));this.scene=new THREE.Scene();this.webGLRenderer=new THREE.WebGLRenderer({antialias:this.getAntiAlias(),alpha:this.getAlpha()});this.webGLRenderer.setSize(this.getWidth(),this.getHeight());this.webGLRenderer.setClearColor(0xffffff,0);this.webGLRenderer.setPixelRatio(window.devicePixelRatio);},getScene:function getScene(){return this.scene;},getWebGLRenderer:function getWebGLRenderer(){return this.webGLRenderer;},_renderPerFrame:function _renderPerFrame(){var camera=this.getAggregation("camera").getCamera();var scene=this.getScene();var webGLRenderer=this.getWebGLRenderer();this.fireNextFrame();webGLRenderer.render(scene,camera);camera.lookAt(scene.position);requestAnimationFrame(this._renderPerFrame.bind(this));},renderer:{render:function render(rendererManager,control){var scene=control.getScene();var loadingManager=new THREE.LoadingManager();var objLoader=new THREE.OBJLoader(loadingManager);var htmlCanvas=new HTML().setDOMContent(control.getWebGLRenderer().domElement);scene.add(control.getAggregation("ambientLight").getAmbientLight());scene.add(control.getAggregation("directionalLight").getDirectionalLight());rendererManager.write("<div");rendererManager.writeControlData(control);rendererManager.write(">");rendererManager.write("<ul");rendererManager.write(">");rendererManager.renderControl(htmlCanvas);rendererManager.renderControl(control.getAggregation("camera"));rendererManager.renderControl(control.getAggregation("ambientLight"));rendererManager.renderControl(control.getAggregation("directionalLight"));rendererManager.write("</div>");jQuery.each(control.getObjects(),function(x,object){objLoader.load(object.getObjFilePath(),function(loadedObject){loadedObject.position.x=object.getObjPositionX();loadedObject.position.z=object.getObjPositionZ();loadedObject.position.y=object.getObjPositionY();scene.add(loadedObject);control._renderPerFrame();});});}}});});