sap.ui.define(['sap/ui/core/Control','sap/ui/core/HTML'],function(Control,HTML){'use strict';return Control.extend("influenz.de.threeui5.util.THREEScene",{metadata:{properties:{height:{defaultValue:1280,type:"int"},width:{defaultValue:720,type:"int"},antiAlias:{defaultValue:true,type:"boolean"},alpha:{defaultValue:true,type:"boolean"}},events:{nextFrame:{enablePreventDefault:true}},aggregations:{objects:{type:"influenz.de.threeui5.util.THREEObject",multiple:true,singularName:"object"},camera:{types:["influenz.de.threeui5.util.THREEPerspectiveCamera","influenz.de.threeui5.util.THREECubeCamera"],multiple:false},directionalLight:{type:"influenz.de.threeui5.util.THREEDirectionalLight",multiple:false},ambientLight:{type:"influenz.de.threeui5.util.THREEAmbientLight",multiple:false}}},init:function init(){},onBeforeRendering:function onBeforeRendering(){var _this=this;var loadingManager=new THREE.LoadingManager();var objLoader=new THREE.OBJLoader(loadingManager);var textureLoader=new THREE.TextureLoader(loadingManager);this.scene=new THREE.Scene();this.webGLRenderer=new THREE.WebGLRenderer({antialias:this.getAntiAlias(),alpha:this.getAlpha()});this.webGLRenderer.setSize(this.getWidth(),this.getHeight());jQuery.each(this.getObjects(),function(x,object){return objLoader.load(object.getObjFilePath(),function(loadedObject){loadedObject.position.x=object.getObjPositionX();loadedObject.position.z=object.getObjPositionZ();loadedObject.position.y=object.getObjPositionY();_this.getScene().add(loadedObject);_this.getScene().add(_this.getAggregation("directionalLight").getDirectionalLight());_this.getScene().add(_this.getAggregation("ambientLight").getAmbientLight());textureLoader.load(object.getTexturePath(),function(texture){texture.needsUpdate=true;loadedObject.traverse(function(child){if(child instanceof THREE.Mesh){child.material.map=texture;}});});});});},getScene:function getScene(){return this.scene;},getWebGLRenderer:function getWebGLRenderer(){return this.webGLRenderer;},_renderPerFrame:function _renderPerFrame(){var scene=this.getScene();var camera=this.getAggregation("camera").getCamera();var webGLRenderer=this.getWebGLRenderer();this.fireNextFrame();camera.lookAt(scene.position);requestAnimationFrame(this._renderPerFrame.bind(this));webGLRenderer.render(scene,camera);},renderer:{render:function render(rendererManager,control){rendererManager.write("<div");rendererManager.writeControlData(control);rendererManager.write(">");rendererManager.write("<ul");rendererManager.write(">");rendererManager.renderControl(control.getAggregation("camera"));rendererManager.renderControl(control.getAggregation("ambientLight"));rendererManager.renderControl(control.getAggregation("directionalLight"));rendererManager.renderControl(new HTML().setDOMContent(control.getWebGLRenderer().domElement));rendererManager.write("</div>");control._renderPerFrame();}}});});